<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Access Management - Excell Media Pvt. Ltd.</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../../../../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../../../../css/style.min.css" rel="stylesheet">
<link href="../../../../assets/custom.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">

<nav role="navigation">
<ul class="summary">
<li>
<a href="../../../.." target="_blank" class="custom-link">Excell Media Pvt. Ltd.</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="../../../..">Home</a>
<li class="header">Design</li>

<li>
<a href="#">Infrastructure</a>
<ul>

<li>
<a href="../../../infra/" class="">Overview</a>
</li>

<li>
<a href="../../../infra/kubernetes/" class="">Kubernetes</a>
</li>

<li>
<a href="../../../infra/monolithic/" class="">Monolithic</a>
</li>
</ul>
</li>

<li>
<a href="#">Application</a>
<ul>

<li>
<a href="../../" class="">Overview</a>
</li>

<li>
<a href="../../iam/" class="">IAM</a>
</li>

<li>
<a href="#">Microservices</a>
<ul>

<li>
<a href="../" class="">Overview</a>
</li>

<li>
<a href="./" class="active">Access Management</a>
</li>

<li>
<a href="../iam-admin-api/" class="">User Admin API</a>
</li>

<li>
<a href="../core-api/" class="">Core API</a>
</li>

<li>
<a href="../notify/" class="">Notification API</a>
</li>

<li>
<a href="../storage/" class="">Storage API</a>
</li>
</ul>
</li>
</ul>
</li>

<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">

<section class="normal markdown-section">



<h1 id="access-management-microservice">Access Management Microservice</h1>
<h2 id="authentication-flow-for-employee-app-using-keycloak">Authentication Flow for Employee App Using Keycloak</h2>
<p>To enable seamless authentication, Excell’s Employee App follows the OAuth 2.0 Authorization Code Flow using Keycloak as the identity provider (IdP). This ensures that users authenticate securely without exposing their credentials to the application. The process follows Single Sign-On (SSO) principles, meaning once authenticated, the user can access multiple services without logging in again.</p>
<p>The flow involves redirecting unauthenticated users to Keycloak, validating their credentials, and exchanging an authorization code for tokens, which are used to maintain authenticated sessions. Below is the step-by-step process:</p>
<p align="center" style="padding:16px;  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 3px 10px 0 rgba(0, 0, 0, 0.19);">
  <img src="../../../../assets/images/auth.1.svg" alt="image">
</p>

<h3 id="authentication-steps">Authentication Steps</h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Activity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>User Accesses the Employee App</td>
<td>The user attempts to access the Employee App (<code>employee.app.com</code>) but is not logged in.</td>
</tr>
<tr>
<td>2</td>
<td>Employee App Redirects to Keycloak</td>
<td>The Employee App detects the user is unauthenticated and redirects them to Keycloak for login. The request includes parameters such as <code>client_id</code>, <code>redirect_uri</code>, and <code>response_type=code</code>.</td>
</tr>
<tr>
<td>3</td>
<td>User Submits Credentials &amp; Keycloak Validates</td>
<td>The user enters their credentials (username &amp; password) on the Keycloak login page. Keycloak verifies the credentials and checks for any additional authentication requirements (such as MFA, if enabled).</td>
</tr>
<tr>
<td>4</td>
<td>Keycloak Redirects Back to the Employee App with Authorization Code</td>
<td>Once authentication is successful, Keycloak redirects the user to the Employee App with an authorization code in the URL (<code>?code=xyz123</code>). This code is temporary and must be exchanged for tokens.</td>
</tr>
<tr>
<td>5</td>
<td>Employee App Exchanges Code for Tokens &amp; Starts Session</td>
<td>The Employee App makes a server-to-server request to Keycloak’s token endpoint, sending the authorization code along with client credentials. Keycloak responds with an Access Token, ID Token, and Refresh Token. The Employee App verifies the received tokens and establishes an authenticated session for the user.</td>
</tr>
</tbody>
</table>
<p>Once logged in, the user remains authenticated until the session expires or they log out. The tokens can be used for subsequent API calls to verify user identity and permissions.</p>
<p>This process ensures that authentication remains secure and centralized, leveraging Keycloak’s identity and access management capabilities for seamless SSO across Excell’s ecosystem.</p>
<h2 id="authentication-flow-for-backend-apis-using-keycloak">Authentication Flow for Backend APIs Using Keycloak</h2>
<p>To ensure secure access to backend services, the Employee App uses an Access Token issued by Keycloak. This token is included in the HTTP headers of API requests and is verified by the backend before granting access to protected resources. The authentication process ensures that only authorized users can interact with backend services while maintaining security and compliance.</p>
<p>The following diagram illustrates the interaction between the Employee App, Backend API, and Keycloak during token validation.</p>
<p align="center" style=" padding:16px; box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 3px 10px 0 rgba(0, 0, 0, 0.19);">
  <img  src="../../../../assets/images/auth.2.svg" alt="image">
</p>

<h3 id="authentication-steps_1">Authentication Steps</h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Activity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>User Accesses the Employee App</td>
<td>The user is already authenticated and interacts with the Employee App.</td>
</tr>
<tr>
<td>2</td>
<td>App Sends Access Token in HTTP Header</td>
<td>The Employee App includes the Access Token in the HTTP Authorization header when making a request to the backend API.</td>
</tr>
<tr>
<td>3</td>
<td>Backend Looks Up Realm Public Key</td>
<td>The backend checks its cache for the Realm Public Key using the <code>kid</code> (Key ID) in the JWT header to verify the token's signature.</td>
</tr>
<tr>
<td>3a</td>
<td>Fetch Public Key if Not Cached</td>
<td>If the Realm Public Key is not found in the cache, the backend requests it from Keycloak using the <code>kid</code>.</td>
</tr>
<tr>
<td>3b</td>
<td>Keycloak Returns the Realm Public Key</td>
<td>Keycloak provides the Realm Public Key, allowing the backend to verify the token’s signature.</td>
</tr>
<tr>
<td>4</td>
<td>Backend Verifies the Token</td>
<td>The backend validates the Access Token signature using the Realm Public Key to ensure it is authentic and untampered.</td>
</tr>
<tr>
<td>5</td>
<td>Backend Grants Access &amp; Returns Data</td>
<td>Once the token is verified, the backend grants access and returns the requested user data.</td>
</tr>
</tbody>
</table>
<p>This authentication flow ensures that:</p>
<ul>
<li>Only authorized users with a valid Access Token can interact with backend services.</li>
<li>Tokens are securely validated before granting access.</li>
<li>The backend does not store passwords, relying entirely on Keycloak for authentication.</li>
</ul>
<p>This mechanism provides a secure, scalable, and centralized authentication model, leveraging Keycloak's capabilities for identity and access management.</p>
<h3 id="technology-stack">Technology Stack</h3>
<ul>
<li>Latest stable version of keycloak</li>
<li>PostgreSQL for storing keycloak meta data for persistance</li>
</ul>


</section>

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../../../../js/main.js"></script>
<script src="../../../../js/gitbook.min.js"></script>
<script src="../../../../js/theme.min.js"></script>
</body>
</html>